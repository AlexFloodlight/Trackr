var trackr={SEL_LIST_TASKS:"#list-tasks",SEL_THE_BUTTON:"#the-button",SEL_FINISH:"#button-finish",SEL_FINISHED:"#finished",SEL_RECORDS:"#records",SEL_POPUPS:"#popups",SEL_BG_POPUPS:"#bg-popups",SEL_MESSAGES:"#messages",popups:[],jq_list_tasks:{},jq_naming_label:{},jq_finish_button:{},jq_records:{},jq_popups:{},jq_bg_popups:{},jq_messages:{},audio:{},init:function(){var a=window.jQuery;trackr.jq_list_tasks=a(trackr.SEL_LIST_TASKS);trackr.jq_finished=a(trackr.SEL_FINISHED);trackr.jq_naming_label=a("h2");
trackr.jq_records=a(trackr.SEL_RECORDS);trackr.jq_popups=a(trackr.SEL_POPUPS);trackr.jq_bg_popups=a(trackr.SEL_BG_POPUPS);trackr.jq_messages=a(trackr.SEL_MESSAGES);trackr.jq_bg_popups.click(trackr.closePopups);trackr.audio=document.getElementById("audio-pop");new trackr.TheButton(a(trackr.SEL_THE_BUTTON))},playPop:function(){trackr.audio.play()},TheButton:function(a){this.jq_button=a;this.jq_button.click(function(){trackr.ajax({action:"button"},trackr.buttonAjaxResponse);trackr.playPop()})},createFinishButton:function(){var a=
window.jQuery;0<a(trackr.SEL_FINISH).length||0<trackr.jq_list_tasks.children().length||(trackr.jq_finish_button=a('<div id="button-finish">Finish</div>').hide().fadeIn(250).click(trackr.ajaxFinish),trackr.jq_finished.append(trackr.jq_finish_button))},removeFinishButton:function(){0<trackr.jq_finish_button.length&&trackr.jq_finish_button.fadeOut(250,function(){trackr.jq_finish_button.remove()})},createNewInput:function(a){var c=window.jQuery,b,d,e;b=new Date(1E3*a.time);d=b.getHours();e="am";12<d&&
(d-=12,e="pm");b=b.getMinutes();10>b&&(b="0"+b);a=c('<li><form><input type="text" name="'+a.track_id+'" placeholder="At '+(d+":"+b+" "+e)+'" /><div class="okay icon-ok">&nbsp;</div><input type="submit" /></form></li>');new trackr.NamingField(a);trackr.jq_naming_label.fadeIn();trackr.jq_list_tasks.append(a);trackr.setFocus();trackr.removeFinishButton()},setFocus:function(){trackr.jq_list_tasks.children("li:first-child").find('input[type="text"]').focus()},NamingField:function(a){var c=this;this.jq_li=
a;this.jq_ok=a.find(".okay");this.jq_form=a.find("form");this.jq_input=a.find('input[type="text"]');this.FADE_TIME=250;this.jq_form.submit(function(){c.submit();return!1});this.jq_ok.click(function(){c.submit()});trackr.NamingField.prototype.submit=function(){var a=this;""!==a.jq_input.val()&&trackr.ajax({action:"name",id:a.jq_input.attr("name"),name:a.jq_input.val()},function(){a.finish()})};trackr.NamingField.prototype.finish=function(){this.jq_ok.addClass("done");setTimeout(this.remove(),250)};
trackr.NamingField.prototype.remove=function(){var a=this;a.jq_li.fadeOut(a.FADE_TIME,function(){a.jq_li.remove();trackr.createFinishButton();trackr.setFocus()})};return this},showRecords:function(a){var c=a.length,b=window.jQuery,d,e,j,k,f,g,h=b("");g=function(a){var b,d;b=a.getHours();a=a.getMinutes();d="am";12<b&&(b-=12,d="pm");10>a&&(a="0"+a);return b+":"+a+" "+d};for(h=b("<tbody></tbody>");c--;)f=a[c],d=Math.floor(f.age/60),e=f.age-60*d,j=new Date(f.time_start),k=new Date(f.time_end),10>e&&(e=
"0"+e),d=b('<tr title="From '+g(j)+" to "+g(k)+'"><td>'+d+":"+e+"</td><td>"+f.name+"</td></tr>"),h.prepend(d);trackr.jq_records.find("tbody").replaceWith(h);trackr.jq_records.find("tbody tr").removeClass("odd").filter(":odd").addClass("odd");trackr.jq_records.fadeIn()},Popup:function(a){var c=this,b=window.jQuery;this.message=a;this.TIME_FADE=250;this.jq_popup=b("<div>"+a+'<div class="close">&times;</div></div>').hide();this.jq_close=this.jq_popup.find(".close");this.jq_close.click(function(){c.close()});
trackr.Popup.prototype.add=function(){trackr.jq_bg_popups.fadeIn(this.TIME_FADE);trackr.jq_popups.append(this.jq_popup);this.jq_popup.css({"margin-top":-(this.jq_popup.outerHeight(!0)/2)});this.jq_popup.fadeIn(this.TIME_FADE)};trackr.Popup.prototype.close=function(){var a=this;trackr.jq_bg_popups.fadeOut(this.TIME_FADE);this.jq_popup.fadeOut(this.TIME_FADE,function(){a.remove()})};trackr.Popup.prototype.remove=function(){this.jq_popup.remove()};this.add();trackr.popups.push(this);return this},closePopups:function(){for(var a=
trackr.popups.length;a--;)trackr.popups[a].close()},Message:function(a){var c=this,b=window.jQuery;this.message=a;this.TIME_FADE=250;this.DELAY=1500;this.jq_message=b("<div>"+a+"</div>").hide();this.jq_message.click(function(){c.close()});this.timer=setTimeout(function(){c.close()},this.DELAY);trackr.Message.prototype.add=function(){trackr.jq_messages.append(this.jq_message);this.jq_message.fadeIn(this.TIME_FADE)};trackr.Message.prototype.close=function(){var a=this;this.jq_message.fadeOut(this.TIME_FADE,
function(){a.remove()})};trackr.Message.prototype.remove=function(){this.jq_message.remove()};this.add();return this},buttonAjaxResponse:function(a){a.time||a.track_id?trackr.createNewInput(a):new trackr.Message("Started")},finish:function(a){trackr.removeFinishButton();"last_record"===a.type_response?trackr.createNewInput(a):a.type_response&&(0<a.records.length?trackr.showRecords(a.records):new trackr.Popup("<p>All of your tracked times were less than a minute.</p><p>Slow down next time!</p>"))},
ajaxFinish:function(){trackr.ajax({action:"finish"},trackr.finish)},ajax:function(a,c){var b=window.jQuery;b.post("/ajax.php",a,function(a){b.isFunction(c)&&c(a)})}};jQuery(function(){trackr.init()});